<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>WEB SPACE STATION | AURORA PRO TERMINAL</title>

<link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

<style>
:root{
 --bg:#020205;
 --panel:#05050f;
 --blue:#00f3ff;
 --green:#00ff88;
 --red:#ff3355;
 --orange:#ffaa00;
 --border:rgba(0,243,255,.25);
}
*{box-sizing:border-box}
body{
 margin:0;
 background:var(--bg);
 color:#fff;
 font-family:'Exo 2',sans-serif;
}
nav{
 padding:15px 30px;
 background:rgba(0,0,0,.85);
 border-bottom:1px solid var(--border);
 display:flex;
 justify-content:space-between;
}
.logo{
 font-family:'Rajdhani';
 font-weight:700;
 letter-spacing:3px;
}
a{color:#aaa;text-decoration:none;font-size:.75rem}

.dashboard{
 max-width:1500px;
 margin:auto;
 padding:30px 20px;
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
 gap:15px;
}
.card{
 background:var(--panel);
 border:1px solid var(--border);
 padding:18px;
 text-align:center;
}
.label{
 font-size:.65rem;
 letter-spacing:2px;
 text-transform:uppercase;
 color:#777;
}
.value{
 font-family:'Rajdhani';
 font-size:2.2rem;
 margin:6px 0;
 color:var(--blue);
}
.status{font-size:.7rem}

footer{
 text-align:center;
 font-family:monospace;
 font-size:.65rem;
 color:#444;
 margin-bottom:12px;
}

canvas{
 width:100%;
 height:220px;
 background:#020208;
 border:1px solid var(--border);
}
</style>
</head>

<body>

<nav>
 <div class="logo">WEB SPACE STATION</div>
 <div>
  <a href="#">BASE</a>
  <a href="#" style="color:var(--blue)">AURORA PRO</a>
 </div>
</nav>

<section class="dashboard">

 <div class="card">
  <div class="label">Solar Wind Speed</div>
  <div id="speed" class="value">--</div>
  <div class="status">km/s</div>
 </div>

 <div class="card">
  <div class="label">Density</div>
  <div id="density" class="value">--</div>
  <div class="status">p/cm³</div>
 </div>

 <div class="card">
  <div class="label">Bz GSM</div>
  <div id="bz" class="value">--</div>
  <div id="bzTxt" class="status">---</div>
 </div>

 <div class="card">
  <div class="label">Bz South Duration</div>
  <div id="bzTime" class="value">0</div>
  <div class="status">minutes</div>
 </div>

 <div class="card">
  <div class="label">Aurora Probability Index</div>
  <div id="api" class="value">0</div>
  <div id="apiTxt" class="status">QUIET</div>
 </div>

 <div class="card">
  <div class="label">Poland Visibility</div>
  <div id="plVis" class="value">---</div>
  <div id="plTxt" class="status">---</div>
 </div>

</section>

<section class="dashboard">
 <div class="card" style="grid-column:1/-1">
  <div class="label">Bz GSM – last 120 minutes</div>
  <canvas id="chart"></canvas>
 </div>
</section>

<footer id="footer">TERMINAL ONLINE | WAITING FOR DATA</footer>

<script>
const plasmaURL="https://services.swpc.noaa.gov/products/solar-wind/plasma-2-hour.json";
const magURL="https://services.swpc.noaa.gov/products/solar-wind/mag-2-hour.json";

let bzHistory=[];
let southStart=null;

async function fetchJSON(url){
 const r=await fetch(url,{cache:"no-store"});
 if(!r.ok) throw new Error("fetch");
 return r.json();
}

function lastValid(data,i){
 for(let x=data.length-1;x>0;x--){
  if(data[x][i]!==null) return data[x];
 }
 return null;
}

function calcAPI(speed,bz,d){
 let s=0;
 if(speed>500) s+=2;
 if(speed>650) s+=3;
 if(bz<-5) s+=2;
 if(bz<-10) s+=4;
 if(d>10) s+=1;
 return s;
}

function polandVisibility(speed,bz,d,southMin){
 if(bz>-5 || southMin<10) return ["NOT VISIBLE","Too weak / unstable", "var(--green)"];

 if(speed>650 && bz<-12 && southMin>30)
  return ["VERY HIGH","Likely visible to naked eye", "var(--red)"];

 if(speed>580 && bz<-8 && southMin>20)
  return ["HIGH CHANCE","Photos + naked eye north", "var(--orange)"];

 if(speed>520 && bz<-6 && southMin>15)
  return ["POSSIBLE","Camera / northern horizon", "var(--blue)"];

 return ["LOW","Marginal conditions", "#666"];
}

function draw(){
 const c=document.getElementById("chart");
 const ctx=c.getContext("2d");
 c.width=c.offsetWidth;
 c.height=c.offsetHeight;

 ctx.clearRect(0,0,c.width,c.height);

 const max=20,min=-20;
 ctx.strokeStyle="#00f3ff";
 ctx.beginPath();

 bzHistory.forEach((v,i)=>{
  const x=i/(bzHistory.length-1)*c.width;
  const y=c.height-(v-min)/(max-min)*c.height;
  i?ctx.lineTo(x,y):ctx.moveTo(x,y);
 });
 ctx.stroke();

 ctx.strokeStyle="#333";
 const y0=c.height-(0-min)/(max-min)*c.height;
 ctx.beginPath();
 ctx.moveTo(0,y0);ctx.lineTo(c.width,y0);ctx.stroke();
}

async function update(){
 const f=document.getElementById("footer");
 try{
  const plasma=await fetchJSON(plasmaURL);
  const mag=await fetchJSON(magURL);

  const pH=plasma[0];
  const p=lastValid(plasma,pH.indexOf("speed"));

  const speed=+p[pH.indexOf("speed")];
  const dens=+p[pH.indexOf("density")];

  document.getElementById("speed").innerText=Math.round(speed);
  document.getElementById("density").innerText=dens.toFixed(1);

  const mH=mag[0];
  const m=lastValid(mag,mH.indexOf("bz_gsm"));
  const bz=+m[mH.indexOf("bz_gsm")];

  document.getElementById("bz").innerText=bz.toFixed(1);
  document.getElementById("bz").style.color=bz<-5?"var(--red)":"var(--blue)";
  document.getElementById("bzTxt").innerText=bz<0?"SOUTH":"NORTH";

  if(bz<0){ if(!southStart) southStart=Date.now(); }
  else southStart=null;

  const southMin=southStart?Math.floor((Date.now()-southStart)/60000):0;
  document.getElementById("bzTime").innerText=southMin;

  bzHistory.push(bz);
  if(bzHistory.length>120) bzHistory.shift();
  draw();

  const api=calcAPI(speed,bz,dens);
  document.getElementById("api").innerText=api;

  const apiTxt=document.getElementById("apiTxt");
  if(api>=8){apiTxt.innerText="STORM";apiTxt.style.color="var(--red)";}
  else if(api>=5){apiTxt.innerText="WATCH";apiTxt.style.color="var(--orange)";}
  else{apiTxt.innerText="QUIET";apiTxt.style.color="var(--green)";}

  const [v,t,c]=polandVisibility(speed,bz,dens,southMin);
  document.getElementById("plVis").innerText=v;
  document.getElementById("plTxt").innerText=t;
  document.getElementById("plVis").style.color=c;

  f.innerText="LAST UPDATE: "+new Date().toLocaleTimeString();
  f.style.color="#444";

 }catch(e){
  console.error(e);
  f.innerText="DATA ERROR – RETRYING…";
  f.style.color="var(--red)";
 }
}

update();
setInterval(update,60000);
</script>

</body>
</html>
