<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>WEB SPACE STATION | REALTIME SPACE WEATHER</title>

<link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

<style>
:root{
 --bg:#020205;
 --panel:#05050f;
 --blue:#00f3ff;
 --green:#00ff88;
 --red:#ff3355;
 --orange:#ffaa00;
 --border:rgba(0,243,255,.25);
}
*{box-sizing:border-box}
body{
 margin:0;
 background:var(--bg);
 color:#fff;
 font-family:'Exo 2',sans-serif;
}
nav{
 padding:15px 30px;
 background:rgba(0,0,0,.85);
 border-bottom:1px solid var(--border);
 display:flex;
 justify-content:space-between;
}
.logo{
 font-family:'Rajdhani';
 font-weight:700;
 letter-spacing:3px;
}
a{color:#aaa;text-decoration:none;font-size:.75rem}

.dashboard{
 max-width:1400px;
 margin:auto;
 padding:30px 20px;
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
 gap:15px;
}
.card{
 background:var(--panel);
 border:1px solid var(--border);
 padding:18px;
 text-align:center;
}
.label{
 font-size:.65rem;
 letter-spacing:2px;
 text-transform:uppercase;
 color:#777;
}
.value{
 font-family:'Rajdhani';
 font-size:2.3rem;
 margin:6px 0;
 color:var(--blue);
}
.status{font-size:.65rem}
footer{
 text-align:center;
 font-family:monospace;
 font-size:.65rem;
 color:#444;
 margin:10px 0;
}

canvas{
 width:100%;
 height:220px;
 background:#020208;
 border:1px solid var(--border);
}

.alert{
 animation:blink 1s infinite;
}
@keyframes blink{
 0%{background:#200}
 50%{background:#400}
 100%{background:#200}
}
</style>
</head>

<body>

<nav>
 <div class="logo">WEB SPACE STATION</div>
 <div>
  <a href="#">BASE</a>
  <a href="#" style="color:var(--blue)">REALTIME</a>
 </div>
</nav>

<section class="dashboard">
 <div class="card">
  <div class="label">Solar Wind Speed</div>
  <div id="speed" class="value">--</div>
  <div class="status">km/s</div>
 </div>

 <div class="card">
  <div class="label">Density</div>
  <div id="density" class="value">--</div>
  <div class="status">p/cm³</div>
 </div>

 <div class="card">
  <div class="label">Bz GSM</div>
  <div id="bz" class="value">--</div>
  <div id="bzStatus" class="status">---</div>
 </div>

 <div class="card">
  <div class="label">Bz South Time</div>
  <div id="bzTimer" class="value">0</div>
  <div class="status">minutes</div>
 </div>

 <div class="card">
  <div class="label">Aurora Probability</div>
  <div id="api" class="value">0</div>
  <div id="apiTxt" class="status">QUIET</div>
 </div>
</section>

<section class="dashboard">
 <div class="card" style="grid-column:1/-1">
  <div class="label">Bz GSM – Last 120 min</div>
  <canvas id="chart"></canvas>
 </div>
</section>

<footer id="footer">TERMINAL ONLINE | WAITING FOR DATA</footer>

<script>
const plasmaURL="https://services.swpc.noaa.gov/products/solar-wind/plasma-2-hour.json";
const magURL="https://services.swpc.noaa.gov/products/solar-wind/mag-2-hour.json";

let bzHistory=[];
let southStart=null;

async function fetchJSON(url){
 const r=await fetch(url,{cache:"no-store"});
 if(!r.ok) throw new Error("Fetch error");
 return r.json();
}

function lastValid(data,index){
 for(let i=data.length-1;i>0;i--){
  if(data[i][index]!==null) return data[i];
 }
 return null;
}

function calcAPI(speed,bz,dens){
 let score=0;
 if(speed>500) score+=2;
 if(speed>650) score+=3;
 if(bz<-5) score+=2;
 if(bz<-10) score+=4;
 if(dens>10) score+=1;
 return score;
}

function drawChart(){
 const c=document.getElementById("chart");
 const ctx=c.getContext("2d");
 c.width=c.offsetWidth;
 c.height=c.offsetHeight;

 ctx.clearRect(0,0,c.width,c.height);
 ctx.strokeStyle="#00f3ff";
 ctx.beginPath();

 const max=20;
 const min=-20;

 bzHistory.forEach((v,i)=>{
  const x=i/(bzHistory.length-1)*c.width;
  const y=c.height-(v-min)/(max-min)*c.height;
  if(i===0) ctx.moveTo(x,y);
  else ctx.lineTo(x,y);
 });

 ctx.stroke();

 ctx.strokeStyle="#333";
 ctx.beginPath();
 const zeroY=c.height-(0-min)/(max-min)*c.height;
 ctx.moveTo(0,zeroY);
 ctx.lineTo(c.width,zeroY);
 ctx.stroke();
}

async function update(){
 const footer=document.getElementById("footer");
 try{
  const plasma=await fetchJSON(plasmaURL);
  const mag=await fetchJSON(magURL);

  const pH=plasma[0];
  const p=lastValid(plasma,pH.indexOf("speed"));

  const speed=+p[pH.indexOf("speed")];
  const density=+p[pH.indexOf("density")];

  document.getElementById("speed").innerText=Math.round(speed);
  document.getElementById("density").innerText=density.toFixed(1);

  const mH=mag[0];
  const m=lastValid(mag,mH.indexOf("bz_gsm"));
  const bz=+m[mH.indexOf("bz_gsm")];

  document.getElementById("bz").innerText=bz.toFixed(1);
  document.getElementById("bz").style.color=bz<-5?"var(--red)":"var(--blue)";
  document.getElementById("bzStatus").innerText=bz<0?"SOUTH":"NORTH";

  if(bz<0){
   if(!southStart) southStart=Date.now();
  } else southStart=null;

  const southMin=southStart?Math.floor((Date.now()-southStart)/60000):0;
  document.getElementById("bzTimer").innerText=southMin;

  bzHistory.push(bz);
  if(bzHistory.length>120) bzHistory.shift();
  drawChart();

  const api=calcAPI(speed,bz,density);
  document.getElementById("api").innerText=api;

  const apiTxt=document.getElementById("apiTxt");
  let state="QUIET",col="var(--green)";
  if(api>=8){state="STORM";col="var(--red)"}
  else if(api>=5){state="WATCH";col="var(--orange)"}

  apiTxt.innerText=state;
  apiTxt.style.color=col;

  if(api>=8 && southMin>15){
   document.body.classList.add("alert");
  } else document.body.classList.remove("alert");

  footer.innerText="LAST UPDATE: "+new Date().toLocaleTimeString();
  footer.style.color="#444";

 }catch(e){
  console.error(e);
  footer.innerText="DATA ERROR – RETRYING…";
  footer.style.color="var(--red)";
 }
}

update();
setInterval(update,60000);
</script>

</body>
</html>
